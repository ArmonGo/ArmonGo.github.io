<!-- Javascript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="{{ site.baseurl_javascripts }}imagesloaded.pkgd.min.js"></script>

{% if page.syntaxHighlighter %}
  <script src="{{ site.baseurl_javascripts }}prism.js"></script>
  <script src="{{ site.baseurl_javascripts }}plugins/prism-line-numbers.min.js"></script>
{% endif %}

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const elems = document.querySelectorAll('.content-body .img');
    let scrollY = 0;

    function showModal(url, alt = '') {
      // 1) capture current scroll position
      scrollY = window.scrollY || window.pageYOffset;

      // 2) freeze the page at that position
      document.body.style.position = 'fixed';
      document.body.style.top      = `-${scrollY}px`;
      document.body.style.left     = '0';
      document.body.style.right    = '0';
      // (width is implied)

      // 3) create & show the modal
      const backdrop = document.createElement('div');
      backdrop.className = 'image-modal-backdrop';
      const img = document.createElement('img');
      img.src = url;
      img.alt = alt;
      backdrop.appendChild(img);

      backdrop.addEventListener('click', () => {
        // remove modal
        document.body.removeChild(backdrop);
        // 4) un-freeze the page, restoring scroll
        document.body.style.position = '';
        document.body.style.top      = '';
        document.body.style.left     = '';
        document.body.style.right    = '';
        window.scrollTo(0, scrollY);
      });

      document.body.appendChild(backdrop);
    }

    elems.forEach(el => {
      el.style.cursor = 'zoom-in';
      el.addEventListener('click', () => {
        let imgUrl = '';
        let altText = '';

        if (el.tagName === 'IMG') {
          imgUrl  = el.src;
          altText = el.alt || '';
        } else {
          const bg = getComputedStyle(el).backgroundImage;
          const m  = bg.match(/^url\(["']?(.*?)["']?\)$/);
          if (m) imgUrl = m[1];
        }

        if (imgUrl) showModal(imgUrl, altText);
      });
    });
  });


  
  $(document).ready(function(){

    // Featured image loaded behavior
    $('.section-backgroundImage img').imagesLoaded()
      .done( function( instance ) {
        $('.post-featuredImage').addClass('is-loaded');
      });

    // Modal toggle behavior
    $('.modal-toggle-wrapper').click(function() {
    	$(this).toggleClass('active');
      $('.modal-toggle-bubble').toggleClass('active');
    	$('.modal-toggle-bubbleShadow').toggleClass('active');
      $('.modal-toggle-close-wrapper').toggleClass('active');
      $('.fullscreenModal').toggleClass('active');
    });

    // Prevent default anchor event and make a share popup
    $.fn.sharePopup = function (e, intWidth, intHeight, blnResize) {

      e.preventDefault();
      intWidth = intWidth || '750';
      intHeight = intHeight || '500';
      strResize = (blnResize ? 'yes' : 'no');

      //// Set title and open popup with focus on it
      var strTitle = ((typeof this.attr('title') !== 'undefined') ? this.attr('title') : 'Social Share'),
          strParam = 'width=' + intWidth + ',height=' + intHeight + ',resizable=' + strResize,
          objWindow = window.open(this.attr('href'), strTitle, strParam).focus();
    }

    $('.shareButton').on("click", function(e) {
      $(this).sharePopup(e);
    });
  });

  // Show modal toggle after scrolling 300px
  $(document).scroll(function() {
    $('.modal-toggle-group').toggleClass('active', $(document).scrollTop() >= 300);
  });
</script>
